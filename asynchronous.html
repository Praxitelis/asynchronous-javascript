<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Asynchronous JavaScript</title>
</head>
<body>
    <h1>Asynchronous JavaScript</h1>
    <script>

    	/*const second = () => {
    		setTimeout(() => {
    			console.log('Async, Hey there!');
    		}, 2000);
    	}


        const first = () => {
        	console.log('Hey there!');
        	second();
        	console.log('the end!');
        }

        first();*/


// The following is an example of the so called 'callback hell', which is a callback inside a callback inside a callback and so on.
        /*function getRecipe() {

        	setTimeout(() => {

        		const recipeID = [45, 346, 23, 56];
        		console.log(recipeID);

        		setTimeout((id) => {

        			const recipe = {title: 'Fresh tomato pasta', publisher: 'Telis'};
        			console.log(`${id}: ${recipe.title}`);

        			setTimeout(publisher => {
        				const recipe = {title: 'Italian Pizza', publisher: 'Telis'};
        				console.log(recipe);

        			}, 1500, recipe.publisher);

        		}, 1500, recipeID[2]);

        	}, 1500);

        }
        getRecipe();*/

        //recreating the part from the code above, where we get the ids from the server(fake ajax call)
        //the executor function gets two arguements, the callback functions resolve and reject. Its because it is used to inform the promise if the event it is handling was successful or not. In this case we dont have to use the reject function.
        const getIDs = new Promise((resolve, reject) => {
        	setTimeout(() => {
        		resolve([45, 346, 23, 56]);
        	}, 1500);

        });

        const getRecipe = recID => {
        	return new Promise((resolve, reject) => {
        		setTimeout(ID => {
        			const recipe = {title: 'Fresh tomato pasta', publisher: 'Telis'};
        			resolve(`${ID}: ${recipe.title}`);

        		}, 1500, recID);
        		
        	});
        };

        const getRelated = publisher => {
        	return new Promise((resolve, reject) => {
        		setTimeout(pub => {
        			const recipe = {title: 'Italian Pizza', publisher: 'Telis'};
        			resolve(`${pub}: ${recipe.title}`);
        		}, 1500, publisher);

        	});

        };

        /*getIDs.then(IDs => {
        	console.log(IDs);
        });*/

        getIDs
        .then(IDs => {
        	console.log(IDs);
        	return getRecipe(IDs[2]);
        })
        .then(recipe => {
        	console.log(recipe);
        	return getRelated('Telis Nikolaou');
        })
        .then(recipe => {
        	console.log(recipe);
        })

        .catch(error => {
        	console.log(error);
        });






    </script>
</body>
</html>